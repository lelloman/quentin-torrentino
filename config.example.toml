# Quentin Torrentino Configuration
# Copy this file to config.toml and modify as needed

# ==============================================================================
# AUTHENTICATION (REQUIRED)
# ==============================================================================
# The service will not start without an explicit [auth] section.
# You must choose an authentication method.

[auth]
# Available methods:
#   - "none": No authentication (for local/development use only)
#   - "api_key": Static API key authentication
#
# Default: "none"
method = "none"

# For API key authentication:
# Set method = "api_key" and provide a key.
# The key can be passed in requests via:
#   - Authorization: Bearer <api_key>
#   - X-API-Key: <api_key>
#
# Example:
# method = "api_key"
# api_key = "your-secret-api-key-here"

# ==============================================================================
# SERVER
# ==============================================================================

[server]
# IP address to bind to
# Default: "0.0.0.0" (all interfaces)
host = "0.0.0.0"

# Port to listen on
# Default: 8080
port = 8080

# ==============================================================================
# DATABASE
# ==============================================================================

[database]
# Path to SQLite database file
# The database stores audit events and (in future phases) ticket state
# Default: "quentin.db" (current directory)
path = "quentin.db"

# ==============================================================================
# SEARCH (OPTIONAL)
# ==============================================================================
# Configure a search backend to enable torrent searching.
# Currently only Jackett is supported.
# Indexers are auto-discovered from Jackett - configure them there.

# Uncomment and configure to enable search:

# [searcher]
# backend = "jackett"
#
# [searcher.jackett]
# url = "http://localhost:9117"
# api_key = "your-jackett-api-key"  # Find this in Jackett UI
# timeout_secs = 30

# ==============================================================================
# TORRENT CLIENT (OPTIONAL)
# ==============================================================================
# Configure a torrent client to enable torrent management.
# Choose between:
#   - "librqbit" (embedded, no external service needed)
#   - "qbittorrent" (requires external qBittorrent instance)

# Option 1: Embedded librqbit (recommended for simple setups)
# No external service needed - torrents are downloaded directly by this app.

# [torrent_client]
# backend = "librqbit"
#
# [torrent_client.librqbit]
# download_path = "/downloads"            # Directory to save downloaded files
# enable_dht = true                       # Enable DHT for peer discovery (default: true)
# listen_port = 6881                      # Optional: TCP port for incoming connections
# persistence_path = "/data/librqbit"     # Optional: persist session state between restarts

# Option 2: External qBittorrent

# [torrent_client]
# backend = "qbittorrent"
#
# [torrent_client.qbittorrent]
# url = "http://localhost:8080"          # qBittorrent Web UI URL
# username = "admin"                      # Web UI username
# password = "adminadmin"                 # Web UI password
# download_path = "/downloads"            # Optional: default download path
# timeout_secs = 30                       # Request timeout (default: 30)

# ==============================================================================
# TEXTBRAIN (OPTIONAL)
# ==============================================================================
# TextBrain handles intelligent torrent matching using heuristics and/or LLM.
# Default mode is "dumb_only" which uses fast heuristic matching.

# [textbrain]
# # Coordination mode:
# #   - "dumb_only": Heuristics only, no LLM (default, fastest, works offline)
# #   - "dumb_first": Try heuristics first, use LLM if confidence is low
# #   - "llm_first": Use LLM first, fall back to heuristics on error
# #   - "llm_only": Only LLM, fail if unavailable
# mode = "dumb_only"
#
# # Score threshold for auto-approval (0.0-1.0)
# # Candidates scoring >= this threshold are auto-approved
# auto_approve_threshold = 0.85
#
# # Confidence threshold for LLM fallback (in dumb_first mode)
# # If heuristic confidence < this, try LLM
# confidence_threshold = 0.7
#
# # Maximum search queries to try before giving up
# max_queries = 5

# LLM configuration (required for modes that use LLM)
# Example with local Ollama:

# [textbrain.llm]
# provider = "ollama"                     # "anthropic", "openai", "ollama", "custom"
# model = "llama2"                        # Model name
# # api_key = "sk-..."                    # Required for anthropic/openai
# # api_base = "http://localhost:11434"   # Optional: custom endpoint
# timeout_secs = 60                       # Request timeout
# max_tokens = 1024                       # Max tokens for completions

# File enrichment configuration
# When enabled, fetches .torrent files to get actual file listings before scoring.
# This allows accurate matching for discographies, season packs, etc.

# [textbrain.file_enrichment]
# # Enable file enrichment (default: true)
# enabled = true
#
# # Maximum candidates to enrich with file listings
# max_candidates = 15
#
# # Minimum preliminary score to qualify for enrichment (0.0-1.0)
# # Only candidates scoring above this threshold get enriched
# min_score_threshold = 0.4
#
# # Timeout for fetching each .torrent file (seconds)
# fetch_timeout_secs = 10
#
# # Maximum concurrent .torrent file downloads
# max_parallel_fetches = 5

# ==============================================================================
# ORCHESTRATOR (OPTIONAL)
# ==============================================================================
# The orchestrator automatically processes tickets through the pipeline:
# Pending -> Acquiring -> Approved/NeedsApproval -> Downloading -> Pipeline
#
# Requires: searcher AND torrent_client to be configured.

# [orchestrator]
# # Enable automatic ticket processing
# enabled = true
#
# # How often to poll for pending tickets (milliseconds)
# # The acquisition loop processes one ticket at a time
# acquisition_poll_interval_ms = 5000    # 5 seconds
#
# # How often to check download progress (milliseconds)
# download_poll_interval_ms = 3000       # 3 seconds
#
# # Score threshold for auto-approval (0.0-1.0)
# # Candidates >= this threshold skip manual approval
# auto_approve_threshold = 0.85
#
# # Maximum concurrent downloads (0 = unlimited)
# max_concurrent_downloads = 3
#
# # Stall detection and failover settings
# # If a download shows no progress for the timeout, try next candidate
# stall_timeout_round1_secs = 300        # 5 minutes (first pass through candidates)
# stall_timeout_round2_secs = 1800       # 30 minutes (second pass)
# stall_timeout_round3_secs = 7200       # 2 hours (final pass, then fail)
#
# # How many candidates to retain for failover
# max_failover_candidates = 5

# ==============================================================================
# EXTERNAL CATALOGS (OPTIONAL)
# ==============================================================================
# External catalog integration for improved search and matching.
# Enables the ticket wizard to look up metadata from MusicBrainz and TMDB.

# MusicBrainz - Music metadata (albums, tracks, artists)
# No API key required, but rate limited to 1 request/second.

# [external_catalogs.musicbrainz]
# # User-Agent string (MusicBrainz requires proper identification)
# # Format: "AppName/Version ( contact-url-or-email )"
# user_agent = "QuentinTorrentino/0.1.0 ( https://github.com/lelloman/quentin-torrentino )"
#
# # Rate limit delay in milliseconds (default: 1100 for ~1 req/sec)
# rate_limit_ms = 1100
#
# # Base URL (optional, for testing with a mirror)
# # base_url = "https://musicbrainz.org/ws/2"

# TMDB - Movie and TV metadata
# Requires a free API key from https://www.themoviedb.org/settings/api

# [external_catalogs.tmdb]
# api_key = "your-tmdb-api-key"
#
# # Base URL (optional)
# # base_url = "https://api.themoviedb.org/3"

# ==============================================================================
# CONVERTER (OPTIONAL)
# ==============================================================================
# Configuration for the FFmpeg-based audio/video converter.
# These settings control how files are transcoded during the pipeline.

# [converter]
# # Path to ffmpeg binary (default: "ffmpeg" - uses PATH)
# ffmpeg_path = "/usr/bin/ffmpeg"
#
# # Path to ffprobe binary (default: "ffprobe" - uses PATH)
# ffprobe_path = "/usr/bin/ffprobe"
#
# # Temporary directory for intermediate files
# # Default: system temp dir + "quentin-converter"
# temp_dir = "/tmp/quentin-converter"
#
# # Maximum parallel conversions (default: 4)
# max_parallel_conversions = 4
#
# # Timeout for a single conversion job in seconds (default: 3600 = 1 hour)
# timeout_secs = 3600
#
# # Whether to preserve original files after conversion (default: false)
# preserve_originals = false
#
# # FFmpeg log level: quiet, panic, fatal, error, warning, info, verbose, debug, trace
# ffmpeg_log_level = "warning"
#
# # Additional global ffmpeg arguments (optional)
# extra_ffmpeg_args = ["-threads", "2"]

# ==============================================================================
# PLACER (OPTIONAL)
# ==============================================================================
# Configuration for the file placer that moves converted files to destinations.

# [placer]
# # Buffer size for file copies in bytes (default: 8MB)
# buffer_size = 8388608
#
# # Whether to use atomic moves when possible (default: true)
# prefer_atomic_moves = true
#
# # Whether to verify checksums after copying (default: false)
# verify_checksums = false
#
# # Whether to clean up source files after placement (default: false)
# cleanup_sources = false
#
# # Whether to create directories with intermediate paths (default: true)
# create_parents = true
#
# # Maximum parallel file operations (default: 4)
# max_parallel_operations = 4
#
# # Permissions for created directories (Unix only, octal, default: 0755)
# directory_mode = 493  # 0o755 in decimal
#
# # Backup directory for replaced files (optional)
# # backup_dir = "/data/backups"

# ==============================================================================
# PROCESSOR (OPTIONAL)
# ==============================================================================
# Configuration for the processing pipeline that handles conversion and placement.

# [processor]
# # Maximum parallel conversions (default: 4)
# max_parallel_conversions = 4
#
# # Maximum parallel placements (default: 8)
# max_parallel_placements = 8
#
# # Temporary directory for intermediate files
# temp_dir = "/tmp/quentin-processor"
#
# # Whether to clean up source files after successful placement (default: false)
# cleanup_after_placement = false
#
# # Conversion timeout in seconds (default: 3600 = 1 hour)
# conversion_timeout_secs = 3600
#
# # Progress update interval in milliseconds (default: 1000)
# progress_interval_ms = 1000
#
# # Retry configuration
# [processor.retry]
# # Maximum retry attempts (default: 3)
# max_attempts = 3
#
# # Initial delay between retries in seconds (default: 60)
# initial_delay_secs = 60
#
# # Maximum delay between retries in seconds (default: 3600)
# max_delay_secs = 3600
#
# # Exponential backoff multiplier (default: 2.0)
# backoff_multiplier = 2.0
